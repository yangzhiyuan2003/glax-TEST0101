<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>贪吃蛇大作战 Snake Game</title>
<style>
    /* 页面基础样式：居中、暗色背景 */
    body {
        margin: 0;
        padding: 0;
        background-color: #202124; /* 类似Chrome深色模式背景 */
        color: #f1f3f4;
        font-family: 'Courier New', Courier, monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        user-select: none; /* 禁止选中文本 */
    }

    /* 标题与分数 */
    h1 { margin-bottom: 10px; font-size: 24px; letter-spacing: 2px; }
    #score-board { margin-bottom: 20px; font-size: 18px; color: #8ab4f8; }

    /* 游戏画布样式 */
    canvas {
        background-color: #000;
        border: 4px solid #5f6368;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        display: block;
    }

    /* 提示信息 */
    .controls {
        margin-top: 20px;
        font-size: 14px;
        color: #9aa0a6;
        text-align: center;
    }
    
    /* 移动端按钮（仅在窄屏显示） */
    .mobile-controls {
        display: none;
        margin-top: 20px;
        gap: 10px;
    }
    @media (max-width: 600px) {
        .mobile-controls { display: flex; }
        canvas { width: 90vw; height: 90vw; } /* 移动端适配 */
    }
    button {
        padding: 15px 20px;
        background: #3c4043;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 18px;
    }
    button:active { background: #5f6368; }
</style>
</head>
<body>

    <h1>SNAKE 贪吃蛇</h1>
    <div id="score-board">当前得分: 0</div>

    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div class="controls">
        按 <strong>空格键</strong> 开始/暂停<br>
        使用 <strong>方向键</strong> 控制移动
    </div>

    <div class="mobile-controls">
        <button onclick="setDir('LEFT')">⬅️</button>
        <button onclick="setDir('UP')">⬆️</button>
        <button onclick="setDir('DOWN')">⬇️</button>
        <button onclick="setDir('RIGHT')">➡️</button>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score-board');

    // --- 游戏参数 ---
    const box = 20; // 格子大小
    const canvasSize = 400; // 画布尺寸
    let score = 0;
    let gameLoop;
    let isRunning = false;
    let isGameOver = false;

    // 蛇与食物
    let snake = [];
    let food = {};
    let d; // 方向

    // 初始化游戏
    function init() {
        snake = [];
        snake[0] = { x: 9 * box, y: 10 * box }; // 初始位置
        d = null; // 初始静止
        score = 0;
        isGameOver = false;
        isRunning = false;
        scoreEl.innerText = "当前得分: " + score;
        spawnFood();
        
        // 绘制初始画面
        ctx.clearRect(0, 0, canvasSize, canvasSize);
        drawText("按空格键开始", "20px Arial", "#fff", 0);
    }

    // 生成食物（不生成在蛇身上）
    function spawnFood() {
        food = {
            x: Math.floor(Math.random() * (canvasSize/box)) * box,
            y: Math.floor(Math.random() * (canvasSize/box)) * box
        };
        // 简单的防重叠检查
        for(let part of snake) {
            if(part.x === food.x && part.y === food.y) spawnFood();
        }
    }

    // 键盘监听
    document.addEventListener("keydown", direction);
    function direction(event) {
        let key = event.keyCode;
        // 空格键 (32)
        if(key === 32) {
            event.preventDefault(); // 防止滚动
            if(isGameOver) {
                init();
                startGame();
            } else {
                toggleGame();
            }
            return;
        }
        
        // 游戏未开始时，按方向键直接开始
        if(!isRunning && !isGameOver && (key>=37 && key<=40)) {
            startGame();
        }

        // 方向控制 (禁止直接反向)
        if(key === 37 && d !== "RIGHT") d = "LEFT";
        else if(key === 38 && d !== "DOWN") d = "UP";
        else if(key === 39 && d !== "LEFT") d = "RIGHT";
        else if(key === 40 && d !== "UP") d = "DOWN";
    }

    // 移动端/按钮控制接口
    window.setDir = function(dir) {
        if(isGameOver) { init(); startGame(); return; }
        if(!isRunning) startGame();
        
        if(dir === "LEFT" && d !== "RIGHT") d = "LEFT";
        if(dir === "UP" && d !== "DOWN") d = "UP";
        if(dir === "RIGHT" && d !== "LEFT") d = "RIGHT";
        if(dir === "DOWN" && d !== "UP") d = "DOWN";
    }

    function toggleGame() {
        if(isRunning) {
            clearInterval(gameLoop);
            isRunning = false;
            drawText("已暂停", "30px Arial", "#fff", 0);
        } else {
            startGame();
        }
    }

    function startGame() {
        if(isRunning) return;
        isRunning = true;
        gameLoop = setInterval(draw, 100); // 100ms 刷新一次
    }

    // 绘制主函数
    function draw() {
        // 清空画布
        ctx.fillStyle = "#000";
        ctx.fillRect(0, 0, canvasSize, canvasSize);

        // 画蛇
        for(let i = 0; i < snake.length; i++) {
            // 蛇头绿色，身体浅绿
            ctx.fillStyle = (i === 0) ? "#4CAF50" : "#81C784"; 
            ctx.fillRect(snake[i].x, snake[i].y, box, box);
            
            // 蛇身描边（让格子看起来分开）
            ctx.strokeStyle = "#000";
            ctx.strokeRect(snake[i].x, snake[i].y, box, box);
        }

        // 画食物 (红色)
        ctx.fillStyle = "#ff5252";
        ctx.fillRect(food.x, food.y, box, box);

        // --- 逻辑更新 ---
        let snakeX = snake[0].x;
        let snakeY = snake[0].y;

        if(d === "LEFT") snakeX -= box;
        if(d === "UP") snakeY -= box;
        if(d === "RIGHT") snakeX += box;
        if(d === "DOWN") snakeY += box;

        // 如果没有方向（等待开始），直接返回，只绘制不移动
        if(!d) return;

        // 吃到食物
        if(snakeX === food.x && snakeY === food.y) {
            score++;
            scoreEl.innerText = "当前得分: " + score;
            spawnFood();
            // 不移除尾部 -> 变长
        } else {
            snake.pop(); // 移除尾部 -> 移动
        }

        // 碰撞检测 (撞墙 || 撞自己)
        let newHead = { x: snakeX, y: snakeY };

        if(snakeX < 0 || snakeX >= canvasSize || 
           snakeY < 0 || snakeY >= canvasSize || 
           collision(newHead, snake)) {
            
            clearInterval(gameLoop);
            isRunning = false;
            isGameOver = true;
            drawText("GAME OVER", "40px Arial", "red", -20);
            drawText("按空格键重新开始", "20px Arial", "#fff", 20);
            return;
        }

        snake.unshift(newHead);
    }

    // 辅助：碰撞检查
    function collision(head, array) {
        for(let i = 0; i < array.length; i++) {
            if(head.x === array[i].x && head.y === array[i].y) return true;
        }
        return false;
    }

    // 辅助：绘制中心文字
    function drawText(text, font, color, yOffset) {
        ctx.fillStyle = color;
        ctx.font = font;
        ctx.textAlign = "center";
        ctx.fillText(text, canvasSize/2, canvasSize/2 + yOffset);
    }

    // 启动
    init();

</script>
</body>
</html>
